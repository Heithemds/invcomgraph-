<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventaire Atelier</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">üì¶</div>
      <div>
        <div class="title">Inventaire Atelier</div>
        <div class="subtitle">Saisie rapide ‚Ä¢ Base centralis√©e ‚Ä¢ Totaux automatiques</div>
      </div>
    </div>

    <div class="userbox">
      <div id="userBadge" class="badge hidden"></div>
      <button id="btnLogout" class="btn ghost hidden">D√©connexion</button>
    </div>
  </header>

  <main class="container">

    <!-- LOGIN -->
    <section id="viewLogin" class="card">
      <h2>Connexion</h2>
      <p class="muted">Nom + PIN (6 chiffres). Si le nom n‚Äôexiste pas, l‚Äôapp le cr√©e.</p>

      <div class="grid2">
        <div class="field">
          <label>Nom</label>
          <input id="loginName" type="text" placeholder="Ex: Maeva" autocomplete="off" />
        </div>
        <div class="field">
          <label>PIN (6 chiffres)</label>
          <input id="loginPin" type="password" inputmode="numeric" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
      </div>

      <div class="row">
        <button id="btnLogin" class="btn primary">Entrer</button>
        <div id="loginMsg" class="msg"></div>
      </div>

      <div class="divider"></div>

      <details>
        <summary>‚öôÔ∏è Diagnostics rapides</summary>
        <div class="muted small">
          Si GitHub Pages charge mais rien ne s‚Äôenregistre : v√©rifier URL + anon key dans <code>app.js</code>.
        </div>
      </details>
    </section>

    <!-- APP -->
    <section id="viewApp" class="hidden">

      <section class="card">
        <div class="cardHead">
          <h2>Saisie carton</h2>
          <div class="hint">Astuce : √©cris gros au marqueur, l‚Äôapp doit √™tre plus rapide que ton stylo.</div>
        </div>

        <div class="grid3">
          <div class="field">
            <label>D√©signation</label>
            <input id="f_designation" type="text" placeholder="Tshirt / Polo / Chemise..." />
          </div>
          <div class="field">
            <label>R√©f√©rence</label>
            <input id="f_ref" type="text" placeholder="E191" />
          </div>
          <div class="field">
            <label>Grammage</label>
            <input id="f_grammage" type="text" placeholder="190" />
          </div>
        </div>

        <div class="grid3">
          <div class="field">
            <label>Couleur</label>
            <input id="f_couleur" type="text" placeholder="Dark Grey / Urban Orange..." />
          </div>
          <div class="field">
            <label>Manches</label>
            <div class="seg">
              <button class="segBtn" data-manches="MC" id="btnMC">MC</button>
              <button class="segBtn" data-manches="ML" id="btnML">ML</button>
            </div>
            <div class="muted small">R√®gle : seulement MC ou ML.</div>
          </div>
          <div class="field">
            <label>Code carton (optionnel)</label>
            <input id="f_carton" type="text" placeholder="Ex: A12-03" />
          </div>
        </div>

        <div class="divider"></div>

        <h3>Quantit√©s par taille</h3>
        <p class="muted small">Tu peux laisser vide les tailles non pr√©sentes. Marqueur √©pais OK.</p>

        <div class="sizes">
          <div class="sizeRow">
            <div class="size">
              <span>XS</span><input id="q_xs" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>S</span><input id="q_s" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>M</span><input id="q_m" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>L</span><input id="q_l" inputmode="numeric" placeholder="0" />
            </div>
          </div>

          <div class="sizeRow">
            <div class="size">
              <span>XL</span><input id="q_xl" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>XXL</span><input id="q_xxl" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>3XL</span><input id="q_3xl" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>4XL</span><input id="q_4xl" inputmode="numeric" placeholder="0" />
            </div>
          </div>

          <div class="sizeRow">
            <div class="size">
              <span>5XL</span><input id="q_5xl" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>6XL</span><input id="q_6xl" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>7XL</span><input id="q_7xl" inputmode="numeric" placeholder="0" />
            </div>
            <div class="size">
              <span>8XL</span><input id="q_8xl" inputmode="numeric" placeholder="0" />
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button id="btnCalcTotal" class="btn">Calcul total</button>
          <div class="totalBox">
            <span>Total carton</span>
            <strong id="totalCarton">0</strong>
          </div>
          <button id="btnSave" class="btn primary">Valider & Envoyer</button>
        </div>

        <div id="saveMsg" class="msg"></div>
      </section>

      <section class="card">
        <div class="cardHead">
          <h2>Stock total (vue)</h2>
          <div class="hint">Source : <code>stock_total</code> (somme automatique par ref/couleur/manches/taille)</div>
        </div>

        <div class="grid3">
          <div class="field">
            <label>Recherche REF</label>
            <input id="filterRef" type="text" placeholder="Ex: E191" />
          </div>
          <div class="field">
            <label>Couleur</label>
            <input id="filterCouleur" type="text" placeholder="Ex: Dark Grey" />
          </div>
          <div class="field">
            <label>Manches</label>
            <select id="filterManches">
              <option value="">Toutes</option>
              <option value="MC">MC</option>
              <option value="ML">ML</option>
            </select>
          </div>
        </div>

        <div class="row">
          <button id="btnRefresh" class="btn">Actualiser</button>
          <button id="btnExportCsv" class="btn ghost">Exporter CSV</button>
          <div id="stockMsg" class="msg"></div>
        </div>

        <div class="tableWrap">
          <table class="table" id="stockTable">
            <thead>
              <tr>
                <th>REF</th>
                <th>Couleur</th>
                <th>Manches</th>
                <th>Taille</th>
                <th>Qte</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

    </section>

  </main>

  <footer class="footer">
    <span>Inventaire ‚Ä¢ v1</span>
    <span class="muted">Pas de photos stock√©es ‚Ä¢ Envoi direct en base</span>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js"></script>
</body>
</html>
