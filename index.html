<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inventaire Atelier</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand__mark">⚡</div>
      <div class="brand__text">
        <div class="brand__title">Inventaire Atelier</div>
        <div class="brand__subtitle">Saisie rapide • Base centralisée • Totaux automatiques</div>
      </div>
    </div>

    <div class="topbar__actions">
      <div class="pill" id="sessionPill">Non connecté</div>
      <button class="btn btn--ghost" id="logoutBtn" type="button" disabled>Déconnexion</button>
    </div>
  </header>

  <main class="container">
    <section class="grid">
      <!-- LOGIN -->
      <section class="card" id="loginCard">
        <div class="card__head">
          <h2>Connexion</h2>
          <p>Nom + PIN (6 chiffres). Si le nom n’existe pas, l’app le crée.</p>
        </div>

        <form id="loginForm" class="form">
          <div class="row">
            <div class="field">
              <label for="name">Nom</label>
              <input id="name" name="name" type="text" placeholder="Ex: Maeva" autocomplete="off" required />
            </div>
            <div class="field">
              <label for="pin">PIN (6 chiffres)</label>
              <input id="pin" name="pin" type="password" inputmode="numeric" maxlength="6" placeholder="••••••" required />
            </div>
          </div>

          <div class="row row--end">
            <button class="btn btn--primary" type="submit">Entrer</button>
          </div>

          <div class="hint">
            <span class="dot"></span>
            Astuce atelier : le PIN sert juste à éviter les erreurs de nom, pas à faire de la banque.
          </div>
        </form>
      </section>

      <!-- SAISIE -->
      <section class="card" id="entryCard">
        <div class="card__head">
          <h2>Saisie carton</h2>
          <p>Écris gros au marqueur : l’app doit être plus rapide que ton stylo.</p>
        </div>

        <form id="entryForm" class="form">
          <div class="row">
            <div class="field">
              <label for="designation">Désignation</label>
              <input id="designation" name="designation" type="text" placeholder="Tshirt / Polo / Chemise…" autocomplete="off" />
            </div>
            <div class="field">
              <label for="grammage">Grammage</label>
              <input id="grammage" name="grammage" type="number" inputmode="numeric" placeholder="190" />
            </div>
          </div>

          <div class="row">
            <div class="field field--wide">
              <label for="ref">Référence</label>
              <input id="ref" name="ref" type="text" placeholder="E191" autocomplete="off" required />
              <div class="micro">Règle: on accepte “I” comme “1” (ex: 19I → 191).</div>
            </div>
            <div class="field field--wide">
              <label for="couleur">Couleur (nom long)</label>
              <input id="couleur" name="couleur" type="text" placeholder="Dark Grey / Urban Orange…" autocomplete="off" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Manches</label>
              <div class="seg">
                <button type="button" class="seg__btn" data-sleeve="MC">MC</button>
                <button type="button" class="seg__btn" data-sleeve="ML">ML</button>
              </div>
              <input id="manches" name="manches" type="hidden" required />
              <div class="micro">Obligatoire : MC ou ML.</div>
            </div>

            <div class="field">
              <label for="carton_code">Code carton (optionnel)</label>
              <input id="carton_code" name="carton_code" type="text" placeholder="Ex: A12-03" autocomplete="off" />
            </div>
          </div>

          <div class="divider"></div>

          <div class="sizesHead">
            <h3>Quantités par taille</h3>
            <div class="sizesHead__meta">Laisse vide les tailles absentes. “0” accepté.</div>
          </div>

          <div class="sizesGrid" id="sizesGrid"></div>

          <div class="row row--between">
            <div class="totalBox">
              <div class="totalBox__label">Total carton</div>
              <div class="totalBox__value" id="totalCarton">0</div>
            </div>

            <div class="actions">
              <button class="btn btn--ghost" type="button" id="calcBtn">Calcul total</button>
              <button class="btn btn--primary" type="submit" id="sendBtn">Valider & Envoyer</button>
            </div>
          </div>

          <div class="status" id="statusLine"></div>
        </form>
      </section>

      <!-- HISTO LOCAL + STOCK -->
      <section class="card" id="sideCard">
        <div class="tabs">
          <button class="tab tab--active" data-tab="history" type="button">Historique (local)</button>
          <button class="tab" data-tab="stock" type="button">Stock total</button>
        </div>

        <div class="tabPanel tabPanel--active" id="tab-history">
          <div class="card__head card__head--tight">
            <h2>Derniers cartons saisis</h2>
            <p>Enregistrés sur cet appareil (rapide). Le “counted_by” est en base.</p>
          </div>
          <div class="list" id="historyList"></div>
        </div>

        <div class="tabPanel" id="tab-stock">
          <div class="card__head card__head--tight">
            <h2>Stock total (lecture)</h2>
            <p>Somme par ref / couleur / manches / taille.</p>
          </div>

          <div class="row">
            <div class="field field--wide">
              <label for="stockFilter">Filtre</label>
              <input id="stockFilter" type="text" placeholder="Ex: E191 ou Dark Grey…" autocomplete="off" />
            </div>
            <div class="field field--compact">
              <label>&nbsp;</label>
              <button class="btn btn--ghost" id="refreshStockBtn" type="button">Actualiser</button>
            </div>
          </div>

          <div class="tableWrap">
            <table class="table" id="stockTable">
              <thead>
                <tr>
                  <th>REF</th>
                  <th>Couleur</th>
                  <th>Manches</th>
                  <th>Taille</th>
                  <th>Qté</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="micro" id="stockMeta"></div>
        </div>
      </section>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <!-- Supabase JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./app.js"></script>
</body>
</html>
